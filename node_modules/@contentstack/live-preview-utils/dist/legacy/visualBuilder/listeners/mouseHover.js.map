{"version":3,"sources":["../../../../src/visualBuilder/listeners/mouseHover.ts"],"sourcesContent":["import { throttle } from \"lodash-es\";\nimport { getCsDataOfElement } from \"../utils/getCsDataOfElement\";\nimport { removeAddInstanceButtons } from \"../utils/multipleElementAddButton\";\nimport { generateCustomCursor } from \"../generators/generateCustomCursor\";\nimport { FieldSchemaMap } from \"../utils/fieldSchemaMap\";\nimport { isFieldDisabled } from \"../utils/isFieldDisabled\";\nimport { getFieldType } from \"../utils/getFieldType\";\n\nimport EventListenerHandlerParams from \"./types\";\nimport { VisualBuilder } from \"..\";\nimport { addHoverOutline } from \"../generators/generateHoverOutline\";\nimport { visualBuilderStyles } from \"../visualBuilder.style\";\nimport { VB_EmptyBlockParentClass } from \"../..\";\n\nexport interface HandleMouseHoverParams\n    extends Pick<\n        EventListenerHandlerParams,\n        \"event\" | \"overlayWrapper\" | \"visualBuilderContainer\"\n    > {\n    customCursor: HTMLDivElement | null;\n}\n\nfunction resetCustomCursor(customCursor: HTMLDivElement | null): void {\n    if (customCursor) {\n        generateCustomCursor({\n            fieldType: \"empty\",\n            customCursor: customCursor,\n        });\n    }\n}\n\nfunction handleCursorPosition(\n    event: MouseEvent,\n    customCursor: HTMLDivElement | null\n): void {\n    if (customCursor) {\n        const mouseY = event.clientY;\n        const mouseX = event.clientX;\n\n        customCursor.style.left = `${mouseX}px`;\n        customCursor.style.top = `${mouseY}px`;\n    }\n}\n\nfunction addOutline(editableElement: Element, isFieldDisabled?: boolean): void {\n    if (!editableElement) return;\n\n    addHoverOutline(editableElement as HTMLElement, isFieldDisabled);\n}\n\nfunction hideDefaultCursor(): void {\n    if (\n        document?.body &&\n        !document.body.classList.contains(\n            visualBuilderStyles()[\"visual-builder__default-cursor--disabled\"]\n        )\n    )\n        document.body.classList.add(\n            visualBuilderStyles()[\"visual-builder__default-cursor--disabled\"]\n        );\n}\n\nfunction showDefaultCursor(): void {\n    if (\n        document?.body &&\n        document.body.classList.contains(\n            visualBuilderStyles()[\"visual-builder__default-cursor--disabled\"]\n        )\n    )\n        document.body.classList.remove(\n            visualBuilderStyles()[\"visual-builder__default-cursor--disabled\"]\n        );\n}\n\nexport function hideHoverOutline(\n    visualBuilderContainer: HTMLDivElement | null\n): void {\n    if (!visualBuilderContainer) {\n        return;\n    }\n    const hoverOutline = visualBuilderContainer.querySelector(\n        \".visual-builder__hover-outline\"\n    );\n    if (!hoverOutline) {\n        return;\n    }\n    hoverOutline.classList.add(\n        visualBuilderStyles()[\"visual-builder__hover-outline--hidden\"]\n    );\n}\n\nexport function hideCustomCursor(customCursor: HTMLDivElement | null): void {\n    showDefaultCursor();\n    customCursor?.classList.remove(\"visible\");\n}\n\nexport function showCustomCursor(customCursor: HTMLDivElement | null): void {\n    hideDefaultCursor();\n    customCursor?.classList.add(\"visible\");\n}\n\nfunction isOverlay(target: HTMLElement): boolean {\n    return target.classList.contains(\"visual-builder__overlay\");\n}\n\nfunction isContentEditable(target: HTMLElement): boolean {\n    if (target.hasAttribute(\"contenteditable\"))\n        return target.getAttribute(\"contenteditable\") === \"true\";\n    return false;\n}\n\nasync function handleMouseHover(params: HandleMouseHoverParams): Promise<void> {\n    throttle(async (params: HandleMouseHoverParams) => {\n        const eventDetails = getCsDataOfElement(params.event);\n        const eventTarget = params.event.target as HTMLElement | null;\n        if (!eventDetails) {\n            if (\n                eventTarget &&\n                (isOverlay(eventTarget) || isContentEditable(eventTarget))\n            ) {\n                hideCustomCursor(params.customCursor);\n                return;\n            }\n            resetCustomCursor(params.customCursor);\n            removeAddInstanceButtons({\n                eventTarget: params.event.target,\n                visualBuilderContainer: params.visualBuilderContainer,\n                overlayWrapper: params.overlayWrapper,\n            });\n            handleCursorPosition(params.event, params.customCursor);\n            return;\n        }\n\n        const { editableElement, fieldMetadata } = eventDetails;\n        const { content_type_uid, fieldPath } = fieldMetadata;\n\n        if (\n            VisualBuilder.VisualBuilderGlobalState.value\n                .previousSelectedEditableDOM &&\n            VisualBuilder.VisualBuilderGlobalState.value.previousSelectedEditableDOM.isSameNode(\n                editableElement\n            )\n        ) {\n            hideCustomCursor(params.customCursor);\n            return;\n        }\n\n        if (params.customCursor) {\n          const elementUnderCursor = document.elementFromPoint(params.event.clientX, params.event.clientY);\n            if(elementUnderCursor){\n              if(elementUnderCursor.nodeName === \"A\" || elementUnderCursor.nodeName === \"BUTTON\"){\n                elementUnderCursor.classList.add(\n                  visualBuilderStyles()['visual-builder__no-cursor-style']\n                )\n              }\n            }\n\n            if (\n                VisualBuilder.VisualBuilderGlobalState.value\n                    .previousHoveredTargetDOM !== editableElement\n            ) {\n                resetCustomCursor(params.customCursor);\n                removeAddInstanceButtons({\n                    eventTarget: params.event.target,\n                    visualBuilderContainer: params.visualBuilderContainer,\n                    overlayWrapper: params.overlayWrapper,\n                });\n            }\n\n            if (!FieldSchemaMap.hasFieldSchema(content_type_uid, fieldPath)) {\n                generateCustomCursor({\n                    fieldType: \"loading\",\n                    customCursor: params.customCursor,\n                });\n            }\n\n            /**\n             * We called it seperately inside the code block to ensure that\n             * the code will not wait for the promise to resolve.\n             * If we get a cache miss, we will send a message to the iframe\n             * without blocking the code.\n             */\n            FieldSchemaMap.getFieldSchema(content_type_uid, fieldPath).then(\n                (fieldSchema) => {\n                    if(!fieldSchema) return;\n                    if (!params.customCursor) return;\n                    const { isDisabled: fieldDisabled } = isFieldDisabled(\n                        fieldSchema,\n                        eventDetails\n                    );\n                    const fieldType = getFieldType(fieldSchema);\n                    generateCustomCursor({\n                        fieldType,\n                        customCursor: params.customCursor,\n                        fieldDisabled,\n                    });\n                }\n            );\n\n            handleCursorPosition(params.event, params.customCursor);\n            showCustomCursor(params.customCursor);\n        }\n\n        if (\n            !editableElement.classList.contains(\n                VB_EmptyBlockParentClass\n            ) &&\n            !editableElement.classList.contains(\"visual-builder__empty-block\")\n        ) {\n            addOutline(editableElement);\n            FieldSchemaMap.getFieldSchema(content_type_uid, fieldPath).then(\n                (fieldSchema) => {\n                    if(!fieldSchema) return;\n                    const { isDisabled: fieldDisabled, reason } =\n                        isFieldDisabled(fieldSchema, eventDetails);\n                    addOutline(editableElement, fieldDisabled);\n                }\n            );\n        }\n\n        if (\n            VisualBuilder.VisualBuilderGlobalState.value\n                .previousHoveredTargetDOM === editableElement\n        ) {\n            return;\n        }\n\n        VisualBuilder.VisualBuilderGlobalState.value.previousHoveredTargetDOM =\n            editableElement;\n    }, 10)(params);\n}\n\nexport default handleMouseHover;\n"],"mappings":"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","names":["isFieldDisabled","params"]}